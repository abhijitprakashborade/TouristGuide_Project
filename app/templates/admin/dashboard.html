{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; max-width: 1400px;">
    <!-- Alert Box -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div
        style="background: #e0f2fe; border: 1px solid #bae6fd; color: #0369a1; padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div style="margin-bottom: 2rem;">
        <h1 style="color: #dc2626; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.2rem;">
            <i class="fas fa-user-shield"></i> Admin Panel
        </h1>
        <p style="color: #64748b; margin: 0;">Manage Users, Places, and Reviews</p>
    </div>

    <div style="display: grid; grid-template-columns: 350px 1fr; gap: 2rem; align-items: start;">

        <!-- Add New Place Form -->
        <div style="border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden; background: white;">
            <div
                style="background: #007bff; color: white; padding: 0.75rem 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-plus-circle"></i> Add New Place
            </div>
            <form action="{{ url_for('admin.add_place') }}" method="POST" enctype="multipart/form-data"
                style="padding: 1.5rem;">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; color: #475569; font-size: 0.9rem; margin-bottom: 0.5rem;">Place
                        Details</label>
                    <input type="text" name="name" placeholder="Place Name" class="form-control"
                        style="background: #f8fafc;" required>
                </div>

                <div style="margin-bottom: 1rem;">
                    <select name="category" class="form-control" style="background: #f8fafc;">
                        <option value="Historical">Historical</option>
                        <option value="Nature">Nature</option>
                        <option value="Park">Park</option>
                        <option value="Museum">Museum</option>
                    </select>
                </div>

                <div style="margin-bottom: 1rem;">
                    <textarea name="description" placeholder="Description" rows="4" class="form-control"
                        style="background: #f8fafc; resize: vertical;"></textarea>
                </div>

                <div style="margin-bottom: 1rem;">
                    <input type="number" step="0.01" name="entry_fee" placeholder="Fee (₹)" class="form-control"
                        style="background: #f8fafc;">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label
                        style="display: block; color: #475569; font-size: 0.9rem; margin-bottom: 0.5rem;">Location</label>
                    <select class="form-control" style="background: #f8fafc; margin-bottom: 0.5rem;">
                        <option>Select State</option>
                        <option>Maharashtra</option>
                        <option>Delhi</option>
                        <option>Karnataka</option>
                        <!-- Add more states -->
                    </select>
                    <select class="form-control" style="background: #f8fafc; color: #94a3b8;" disabled>
                        <option>Select State First</option>
                    </select>
                    <!-- Actual saved address input hidden or merged -->
                    <input type="text" name="address" placeholder="Full Address (For DB)" class="form-control"
                        style="margin-top: 0.5rem; background: #f8fafc;" required>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; color: #475569; font-size: 0.9rem; margin-bottom: 0.5rem;">Map
                        Coordinates</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="number" step="any" name="latitude" placeholder="Latitude" class="form-control"
                            style="background: #f8fafc;">
                        <input type="number" step="any" name="longitude" placeholder="Longitude" class="form-control"
                            style="background: #f8fafc;">
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="display: block; color: #475569; font-size: 0.9rem; margin-bottom: 0.5rem;">Visuals</label>
                    <div style="border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 0.5rem;">
                        <div style="margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Option A: Upload File
                        </div>
                        <input type="file" name="image" class="form-control"
                            style="font-size: 0.9rem; margin-bottom: 1rem;">
                        <div style="margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Option B: Paste Link
                        </div>
                        <input type="text" placeholder="http://..." class="form-control" style="background: #f8fafc;">
                    </div>
                </div>

                <button type="submit"
                    style="width: 100%; background: #198754; color: white; border: none; padding: 0.8rem; border-radius: 0.3rem; font-weight: 600; cursor: pointer;">
                    Add Place
                </button>
            </form>
        </div>

        <!-- Right Column -->
        <div style="display: flex; flex-direction: column; gap: 2rem;">

            <!-- Manage Places -->
            <div style="border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden; background: white;">
                <div
                    style="background: #212529; color: white; padding: 0.75rem 1rem; font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                    <span>Manage Places</span>
                    <span
                        style="background: white; color: black; padding: 0.2rem 0.6rem; border-radius: 0.2rem; font-size: 0.8rem;">{{
                        place_count }} Places</span>
                </div>

                <div style="max-height: 500px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8fafc; position: sticky; top: 0; z-index: 10;">
                            <tr style="text-align: left; font-size: 0.9rem; color: #475569;">
                                <th style="padding: 1rem;">Img</th>
                                <th style="padding: 1rem;">Name</th>
                                <th style="padding: 1rem;">Fee</th>
                                <th style="padding: 1rem;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for place in places %}
                            <tr style="border-bottom: 1px solid #f1f5f9;">
                                <td style="padding: 0.8rem;">
                                    <img src="{{ url_for('static', filename='uploads/' + place.image_file) }}"
                                        style="width: 40px; height: 40px; border-radius: 0.3rem; object-fit: cover;">
                                </td>
                                <td style="padding: 0.8rem;">
                                    <div style="font-weight: 600;">{{ place.name }}</div>
                                    <div style="font-size: 0.8rem; color: #64748b;">
                                        {% if place.category == 'Nature' %}<span
                                            style="background: #0ea5e9; color: white; padding: 0.1rem 0.4rem; border-radius: 0.2rem; font-size: 0.7rem;">Nature</span>
                                        {% elif place.category == 'Historical' %}<span
                                            style="background: #f59e0b; color: white; padding: 0.1rem 0.4rem; border-radius: 0.2rem; font-size: 0.7rem;">Historical</span>
                                        {% else %}<span
                                            style="background: #10b981; color: white; padding: 0.1rem 0.4rem; border-radius: 0.2rem; font-size: 0.7rem;">{{
                                            place.category }}</span>
                                        {% endif %}
                                        {{ place.location_address.split(',')[0] }}
                                    </div>
                                </td>
                                <td style="padding: 0.8rem;">₹{{ place.entry_fee }}</td>
                                <td style="padding: 0.8rem;">
                                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                                        <a href="{{ url_for('admin.edit_place', place_id=place.id) }}"
                                            style="background: #0d6efd; color: white; border: none; width: 32px; height: 32px; border-radius: 0.3rem; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none;"><i
                                                class="fas fa-edit"></i></a>
                                        <form action="{{ url_for('admin.delete_place', place_id=place.id) }}"
                                            method="POST" onsubmit="return confirm('Are you sure?');"
                                            style="margin: 0;">
                                            <button type="submit"
                                                style="background: #dc3545; color: white; border: none; width: 32px; height: 32px; border-radius: 0.3rem; cursor: pointer;"><i
                                                    class="fas fa-trash"></i></button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Registered Users -->
            <div style="border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden; background: white;">
                <div
                    style="background: #00c6ff; background: linear-gradient(to right, #00c6ff, #0072ff); color: white; padding: 0.75rem 1rem; font-weight: 600;">
                    <i class="fas fa-users"></i> Registered Users
                </div>
                <div style="padding: 1rem; max-height: 300px; overflow-y: auto;">
                    {% for user in users %}
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #f1f5f9;">
                        <div style="display: flex; align-items: center; gap: 0.8rem;">
                            <div
                                style="background: #64748b; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem;">
                                <i class="fas fa-user{% if user.is_admin %}-shield{% endif %}"></i>
                            </div>
                            <span style="font-weight: 500;">{{ user.username }}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span
                                style="background: {% if user.is_admin %}#dc2626{% else %}#64748b{% endif %}; color: white; padding: 0.2rem 0.6rem; border-radius: 1rem; font-size: 0.75rem;">{%
                                if user.is_admin %}Admin{% else %}User{% endif %}</span>
                            {% if not user.is_admin %}
                            <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST"
                                onsubmit="return confirm('Delete this user?');" style="margin: 0;">
                                <button type="submit"
                                    style="background: none; border: none; color: #dc2626; cursor: pointer;"><i
                                        class="fas fa-times"></i></button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}